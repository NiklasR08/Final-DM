---
title: "Final Group Project Data Mining"
knit: (function(input_file, encoding) {
  out_dir = 'docs';
  rmarkdown::render(input_file,
  encoding=encoding,
  output_file=file.path(dirname(input_file), out_dir, 'index.html'))}
author: "Adriana Barlafante, Guglielmo Bonifazi, Niklas Rengelshausen"
date: "1/11/2022"
output: html_document
editor_options: 
  markdown: 
    wrap: 100
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# World Happiness Report

**Task:** The aim is to study the characteristics of society described in the data sets: what factors affect well-being and how do they relate to each other? The two bases provided should be combined.

## Introduction

For our analysis of the data set we divided our work into multiple steps. To have an overview of our steps please have a look at the Index. The data analysis is made with two data set which we later combined after having a first look at both data sets and the kaggle page to better understand the data.

**Origin of the data:** 
World Happiness (WH): <https://www.kaggle.com/unsdsn/world-happiness> 
Human Freedom Index (HFI): <https://www.kaggle.com/gsutters/the-human-freedom-index>

In addition we had a look at the used the [following book](https://www.cato.org/sites/cato.org/files/2021-01/human-freedom-index-2016.pdf) to better understand the data set of the Human Freedom Index. The data set contains over 120 different variables and to understand these variables the book helped with some descriptions (see p. 185 ff.)

### Index

-- 1. Filtering of the Data Set and Imputation of Values

-- 2. Descriptive Statistics

-- 3. Principal Component Analysis (PCA)

-- 4. Cluster Analysis

-- 5. Multidimensional Scaling

-- 6. Perceptual Maps

-- 7. Possible Extension (NEW HEADLINE NEEDED)

```{r include=FALSE, warning=FALSE}
## PLEASE LOAD LIBRARY HERE AND RERUN CODE CHUNK
library(data.table)
library(tidyverse)
library(VIM)
library(mice)
```

## 1. Filtering of the Data Set and Imputation of Values
We will first load the data set and have a first look to better understand the data. Later we will reduce the information of the data set to only relevant columns and in the end we will impute missing values and merge the two data sets into one.

### 1.1 Loading Data Sets and First Look

```{r}
wh = read.csv("2016.csv")         # World Happiness
hfi = read.csv("hfi_cc_2018.csv") # Human Freedom Index
```

**World Happiness:**

```{r include=TRUE, echo=FALSE}
wh
```

This data set contains information regarding the happiness of different countries. Next to an index score which ranks each country the data set also has a score happiness score on which the happiness rank is based. Additionally the data set contains columns such as GDP or Health Life Expectancy. All the observations are from 2016. 
The columns following the happiness score estimate the extent to which each of six factors – economic production, social support, life expectancy, freedom, absence of corruption, and generosity – contribute to making life evaluations higher in each country than they are in Dystopia, a hypothetical country that has values equal to the world’s lowest national averages for each of the six factors. They have no impact on the total score reported for each country, but they do explain why some countries rank higher than others. 
GDP per Capita, Family, Life Expectancy, Freedom, Generosity, Trust Government Corruption describe the extent to which these factors contribute in evaluating the happiness in each country. The Dystopia Residual metric actually is the Dystopia Happiness Score(1.85) + the Residual value or the unexplained value for each country
([see kaggle](https://www.kaggle.com/unsdsn/world-happiness))


For a further insights please have a look at the descriptive statistics.

**Human Freedom Index:**

```{r}
hfi
```

For the second data set we cans see that it contains 1458 observations and 123 variables. The data set contains a huge number of variables. Nonetheless, they are organized hierarchically so we do not need them all. As previously stated, the data set deals with the human freedom index.

This variable has been computed considering two factors:personal freedom and economic freedom. We can observe that human freedom (hf) is the simple average of economic freedom (ec) and personal freedom (pf).

```{r}
all.equal(hfi$hf_score, (hfi$ef_score + hfi$pf_score)/2)
```

More in detail, economic freedom and personal freedom have been computed using other factors.

```{r}
#Indexes of variables used to compute economic freedom
ec=c(70,81,86,99,118)
colnames(hfi)[ec]
```

```{r}
#Indexes of variables used to compute personal freedom
pf=c(8,22,26,32,44,52,61)
colnames(hfi)[pf]
```

Moreover, even those variables have been computed using other factors. For instance we can observe the composition of pf_rol as the following:

```{r}
colnames(hfi[5:8])
```

This means that pf_rol is calculated by using pf_rol_procedural, pf_rol_civil and pf_rol_criminal. The same holds for other variables as well. Going deeper we can see that some of those variables can be further decomposed:

```{r}
colnames(hfi)[9:22]
```

For instance we can observe that pf_ss can be derived from pf_ss_homicide, disappearances and women. But both disappearances and women can be further divided as you can see.

From this quick analysis is clear that a lot of information is redundant or extremely specific so that we can drop some of the variables we do not need for our analysis.

```{r}
reduced_hfi <- hfi[, c(3, 2, 1, 4, pf, ec, 62, 63, 119, 120, 121, 122, 123)]
dim(reduced_hfi)
```
Column 5-11:      Variables that compute pf 
Column 12-13:     pf_score and pf_rank 
Column 14-18:     Variables that compute ef 
Column 19-10:     ef_score and ef_rank 
Column 21-23:     hf_score, rank and quartile

We were able to reduce the data set from over 120 different variables to a total of 23 variables that we can use for our analysis. Note that this data set still contains data from different years beside 2016.

```{r}
reduced_hfi16 = reduced_hfi[reduced_hfi$year == 2016, ]
dim(reduced_hfi16)
```
If we reduce the data set to data from 2016 only we can see that we only have 162 observations compared to 1458 in total if we consider all years. This first reduction of the data set will help us with our analysis by removing redundant information.

### 1.2 Imputation of missing Values

During our first analysis we noticed that the Human Freedom Index data set is missing some values and the World Happiness index is not missing any values. To have a better analysis we therefore decided to complete the missing information of the data set.

**First Look at Variables:**

```{r}
summary(reduced_hfi16)
missing_hfi <- reduced_hfi16[,5:16]
```

From this first look we can see that there are some values missing for the variables that compute personal freedom and economical freedom. We will now use some descriptive plots to better understand how much data is missing.

**Descriptive statistics with missing values:**

```{r}
aggr(missing_hfi, 
     numbers = T, #to display the numbers on top of the bars
     prop = c(T, F) # prop is a logical indicating whether the proportion of 
     )              # missing values and combinations should be used rather than the total amount
```

The plot shows on the one hand how often a variable is missing and on the other hand in which combinations. We can see that for pf_religion less than one percent of the values is missing and for pf_association more than 15% of the values are missing. Additionally we can see on the second plot that only in one case is pf_religion and pf_association missing, in 25 cases only pf_association is missing and in most of the cases (136) no variable is missing!

**Imputation of Missing Variables:** 
For the imputation of the missing values we will use the mice data set under the following assumptions: We assume that the missing data are missing at random (MAR) which means that the probability that a value is missing depends only on the observed values and can be predicted using them. It imputes data on a variable by variable basis by specifying an imputation model per variable.

We will use the predictive mean matching method (pmm) because the missing data of our data set contains purely numeric variables.

```{r echo=FALSE}
imputed_hfi16 <- mice(reduced_hfi16, m = 5, maxit = 50, seed = 500)
summary(imputed_hfi16)
```

```{r}
complete_hfi <- complete(imputed_hfi16, 1)
```

The data set now has no more missing values. Remember that for pf_association more than 15% of the values were missing in the before imputing them. To see if there is a big difference between the two models we will now compare the distribution of values between the values of pf_association with imputed values and without imputed values.

```{r}
par(mfrow = c(2, 2))
boxplot(missing_hfi$pf_association, main = "Without Imputed Values", ylim = c(0, 12))
boxplot(complete_hfi$pf_association ,main = "With Imputed Values", ylim = c(0, 12))
hist(missing_hfi$pf_association, main = "Without Imputed Values", xlab = "Score pf_association")
hist(complete_hfi$pf_association ,main = "With Imputed Values",  xlab = "Score pf_association")
par(mfrow = c(1,1))
```

The boxplot's look almost the same for both data sets and we can also see that in the distribution not much changed. The histogram "With Imputed Values" might look a different than the other one but that is due to the fact that it contains more values (values that were missing before). Form the boxplot we can see that the median and quantiles are about the same. So for our further analysis we can use the complete data set. We could also have a look at the distribution of pf_religion because we had one missing value there, but given that it is only one value we will probably not see a lot of change between the two data sets.

### 1.3 Merging of the Two Data Sets 
We will now merge the two data sets into one data set with which we can work.

```{r}
#declare as data table
wh <- data.table(wh)
complete_hfi <- data.table(complete_hfi)

# renaming of column to merge both data sets
colnames(wh)[1] = "countries" 

#merge data sets to one
dt <- merge(wh, complete_hfi, by = "countries")

#convert to data table
dt <- data.table(dt)
View(dt)
dim(dt)

```

```{r}
#Create file
out_path <- 'data_merged.csv' ## the file will be stored in the current working directory
fwrite(dt, out_path)

dt <- fread(out_path) 
```


### 1.4 Summary:
In the first step of our analysis we were able to understand the two data sets and do some filtering. This included exploring the variables of the data sets and removing redundant information that we will not need for our further analysis. We saw that some of the variables were missing values. We analyzed the missing values and imputed them with the help of a predictive mean matching method using the mice package. Finally, we merged both data sets into one data set for the further data analysis. The analysis will now continue with some descriptive statistics of the data sets.

## 2. Descriptive Statistics (Niklas)
This part includes a quick data preparation where we will choose the relevant variables for our descriptive data analysis. Furthermore, we will perform some univariate and multivariate statistics and look at the correlation between variables. The goal is to derive some first insights into what could drive well being.

### 2.1 Data Preparation

For the descriptive analysis of the data we will focus just on a part of the data and reduce the data set to the most important data points. 
From the first data set (World Happiness) we will focus on the following variables: countries, Region, Happiness.Score, Economy..GDP.per.Capita., Family, Health..Life.Expectancy., Freedom, Trust..Government.Corruption., Generosity. The Happiness.Score in the end is the closest score that tells us about the well being of individuals in a country. Additionally, the last six of these scores have the potential to deliver some explanation why the Happiness.Score is high or low (we will call them potential influence variables).
From the second data set (Human Freedom Index) we will focus on the following three variables: pf_score, ef_score and hf_score. The reason for that is that these variables are already a calculation of the other variables given in our data set. That way we reduce the number ob variables and do not use redundant information.
```{r}
#dropping information that is not needed
dt_ds <- dt[, c(1,14,2,4,7,8,9,10,11,12,29,31,33)]
dt_ds$Region = as.factor(dt_ds$Region)
dim(dt_ds) #data table descriptive statistics
```


### 2.2 Univariate Analysis
We will now do some univariate analysis for the most important variables to better understand the data that is presented to us. 

**Region**
As a start we can have a look at the different regions our countries come from. Overall we have 137 countries in our data set.
```{r}
table(dt_ds$Region)
```
As you can see the majority of our countries come from Africa (48 total), Europe (43 total) and from the region of Latin America and Caribbean (22 total).

**Happiness.Score**
As stated earlier, happiness score is important to us because it reflects the well being of a country.

```{r}
hist(dt_ds$Happiness.Score, main = "Histogram Happiness Score", xlim = c(1, 10), xlab = "Happiness Score")
```
```{r}
summary(dt_ds$Happiness.Score)
```
From the histogram and the summary statistics we can see that the average and median happiness is around 5,4. The data also does not show any extreme outliers. Given that the score can be anywhere between a 10 (best possible) and a 0 (worst possible) the distribution is not strongly skewed in a direction.

**Potential Influence Variables:**
```{r}
par(mfrow = c(2, 3))
hist(dt_ds$Economy..GDP.per.Capita., main = "GDP per Capita", xlab = "Weight of GDP per Capita", xlim = c(0, 2), ylim = c(0, 40))
hist(dt_ds$Family, main = "Family", xlab = "Weight of Family", xlim = c(0, 2), ylim = c(0, 40))
hist(dt_ds$Health..Life.Expectancy., main = "Health & Life Expectancy", xlab = "Weight of Health & Life Expectancy", xlim = c(0, 2), ylim = c(0, 40))
hist(dt_ds$Freedom, main = "Freedom", xlab = "Weight of Freedom", xlim = c(0, 2), ylim = c(0, 40))
hist(dt_ds$Trust..Government.Corruption., main = "Corruption", xlab = "Weight of Corruption", xlim = c(0, 2), ylim = c(0, 40))
hist(dt_ds$Generosity, main = "Generosity", xlab = "Weight of Generosity", xlim = c(0, 2), ylim = c(0, 40))

par(mfrow = c(1,1))
```

```{r}
summary(dt_ds[, 5:10])
```
From the boxplots we can see that Family, Life Expectancy and Freedom are left-skewed while Corruption and Generosity are more right-skewed. Given that the score measures the weight that a variable has for the calculation of the happiness index makes a direct interpretation not easy. For example, having a high GDP.per.capita value doesn't necessarily mean having a high GDP, only that GDP contributes a lot to the Happiness Score (according to the author of the data). 
If we look at the scale of the histograms we can see that GDP per Capita, Family and Health & Life Expectancy were weighted higher on average, while Freedom, Corruption and Generosity were weighted lower on average.

**Personal Freedom, Economic Freedom and Human Freedom**
```{r}
par(mfrow = c(1, 3))
hist(dt_ds$pf_score, main = "Personal Freedom", xlab = "Score of Personal Freedom", xlim = c(1,10), ylim = c(0, 35))
hist(dt_ds$ef_score, main = "Economic Freedom", xlab = "Score of Economic Freedom", xlim = c(1,10), ylim = c(0, 35))
hist(dt_ds$hf_score, main = "Human Freedom", xlab = "Score of Human Freedom", xlim = c(1,10), ylim = c(0, 35))

par(mfrow = c(1, 1))
```
```{r}
summary(dt_ds[,11:13])
```
The distribution of all three graphs is left-skewed. Based on the median we see no big difference between the economic freedom and personal freedom. The distribution on the other hand is slightly different for the two.
The human freedom score is the average on the pf_score and ef_score which we can see here (average pf_score + average ef_score = average hf_score).

### 2.3 Bi- and Multivariate Analysis


## 3. Principal Component Analysis (PCA) (Adriana)


## 4. Cluster Analysis (Niklas)


## 5. Multidimensional Scaling (Adriana)


## 6. Perceptual Maps (Guglielmo)


## 7. Possible Extension (Guglielmo) (NEW HEADLINE NEEDED)
